<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE  mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="team">
	
	<!-- 전체목록 불러오는 쿼리 -->
	<select id="list" parameterType="hashMap" resultType="hashMap">
		select t1.Team_code, t1.Team_name, t1.Team_intro, t1.Team_cr_date from Team t1
		left outer join Team_has_Tags t2
		on t1.Team_code = t2.Team_Team_code
		<include refid="search"/>
		and t2.Tags_Tag_Name = #{Tags_Tag_Name}
		and t1.Team_code = #{Team_code}
		order by Team_cr_date DESC;
	</select>
	
	
	
	
	<select id="taglist" parameterType="hashMap" resultType="hashMap">
		 select t.Team_name, tag.Tags_Tag_Name from Team t inner join Team_has_Tags tag on t.Team_code = tag.Team_Team_code;
	</select>
	
	
	<select id="tagsearchlist" parameterType="hashMap" resultType="hashMap">	
		select t.Team_name, t.Team_intro, t.Team_cr_date, tag.Tags_Tag_Name from Team t 
		inner join Team_has_Tags tag 
		on t.Team_code = tag.Team_Team_code 
		where 1=1 and tag.Tags_Tag_Name like CONCAT ('%', #{keyword} ,'%')
		order by t.Team_cr_date DESC;
	</select>
	
	<insert id="teammake" parameterType="hashMap">  
	    insert into Team (Team_name,Team_intro) values (#{teamname}, #{teamintro});
	</insert>
	
	
	<select id="tags" parameterType="hashMap" resultType="hashMap">
		select Tag_Name from Tags;
	</select>
	
	
	
	
	
	<sql id="search">
		<choose>
	         <when test="search_option == 'all' ">
	            where 1=1
	            and(t1.Team_name like CONCAT('%', #{keyword}, '%')
	               or t1.Team_intro like CONCAT('%', #{keyword}, '%'))
	         </when>
	         <when test="search_option == 'Teamname'">
	            where 1=1 and Team_name like CONCAT('%', #{keyword}, '%')
	         </when>
	      </choose>
	</sql>
	
</mapper>